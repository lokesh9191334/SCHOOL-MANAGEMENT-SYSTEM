<!-- Sidebar -->
<nav id="sidebar">
    <div class="sidebar-header">
        <div class="user-profile px-4 py-3">
            <div class="d-flex align-items-center">
                <div class="profile-pic me-3">
                    {% if current_user.photo %}
                    <img src="{{ url_for('static', filename=current_user.photo) }}" alt="User Photo" 
                         class="rounded-circle" style="width: 45px; height: 45px; object-fit: cover;">
                    {% else %}
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
                         style="width: 45px; height: 45px; font-size: 1.2rem; font-weight: bold;">
                        {{ current_user.name[0] }}
                    </div>
                    {% endif %}
                </div>
                <div class="profile-info">
                    <h4 class="mb-0 text-sm font-weight-semibold">{{ current_user.name }}</h4>
                    <p class="mb-0 text-xs text-white text-opacity-75 role-text">{{ current_user.role | capitalize }}</p>
                    <div class="profile-details">
                        <div class="detail-item">
                            <i class="fas fa-user"></i>
                            <span>{{ current_user.role | capitalize }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-envelope"></i>
                            <span>{{ current_user.email }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Actions -->
            <div class="profile-actions">
                <a href="{{ url_for('auth.set_password') }}" class="btn btn-password">
                    <i class="fas fa-key"></i>
                    Change Password
                </a>
                <a href="{{ url_for('dashboard.profile') }}" class="btn btn-settings">
                    <i class="fas fa-cog"></i>
                    Settings
                </a>
                <a href="{{ url_for('auth.logout') }}" class="btn btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>
    </div>

    <div class="sidebar-menu">
        <ul class="list-unstyled components py-2">
            <!-- Dashboard Section -->
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Dashboard</div>
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('dashboard.index') }}">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Student Management -->
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Student Management</div>
                <ul class="list-unstyled menu-items">
                    {% if current_user.role != 'teacher' %}
                    <li>
                        <a href="{{ url_for('students.add_student') }}">
                            <i class="fas fa-user-plus"></i>
                            <span>Student Registration</span>
                        </a>
                    </li>
                    {% endif %}
                    <li>
                        <a href="{{ url_for('students.list_students') }}">
                            <i class="fas fa-user-graduate"></i>
                            <span>Students</span>
                        </a>
                    </li>
                    {% if current_user.role != 'teacher' %}
                    <li>
                        <a href="{{ url_for('students.import_students') }}">
                            <i class="fas fa-upload"></i>
                            <span>Import Students (CSV)</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('students.export_students_advanced') }}">
                            <i class="fas fa-download"></i>
                            <span>Export Students (CSV)</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>

            <!-- Academic Management -->
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Academic Management</div>
                <ul class="list-unstyled menu-items">
                    {% if current_user.role == 'parent' %}
                        <li>
                            <a href="{{ url_for('parents.view_children') }}">
                                <i class="fas fa-child"></i>
                                <span>My Children</span>
                            </a>
                        </li>
                    {% else %}
                        <li>
                            <a href="{{ url_for('teachers.list_teachers') }}">
                                <i class="fas fa-chalkboard-teacher"></i>
                                <span>Teachers</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('classes.list_classes') }}">
                                <i class="fas fa-users"></i>
                                <span>Classes</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('subjects.list_subjects') }}">
                                <i class="fas fa-book"></i>
                                <span>Subjects</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('dashboard.events') }}">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Events</span>
                            </a>
                        </li>
                        {% if current_user.role == 'admin' %}
                        <li>
                            <a href="{{ url_for('enhanced_timetable_v2.enhanced_timetable_dashboard') }}">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Timetable Management</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('enhanced_timetable_v2.preview_all_timetables') }}">
                                <i class="fas fa-eye"></i>
                                <span>Preview Timetables</span>
                            </a>
                        </li>
                        {% if current_user.role == 'teacher' %}
                        <li>
                            <a href="{{ url_for('timetable.teacher_timetable') }}">
                                <i class="fas fa-calendar-alt"></i>
                                <span>My Timetable</span>
                            </a>
                        </li>
                        {% endif %}
                        <li>
                            <a href="{{ url_for('admin.manage_users') }}">
                                <i class="fas fa-users-cog"></i>
                                <span>User Management</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('admin.remove_existing_users') }}">
                                <i class="fas fa-user-times"></i>
                                <span>Remove Existing Users</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('admin.clear_users_page') }}">
                                <i class="fas fa-trash-alt"></i>
                                <span>Clear All Users</span>
                            </a>
                        </li>
                        {% endif %}
                        {% if current_user.role == 'teacher' %}
                        <li>
                            <a href="{{ url_for('timetable.teacher_timetable') }}">
                                <i class="fas fa-calendar-alt"></i>
                                <span>My Timetable</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('dashboard.teacher_leave_application') }}">
                                <i class="fas fa-calendar-times"></i>
                                <span>Apply Leave</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('dashboard.teacher_leave_status') }}">
                                <i class="fas fa-clock"></i>
                                <span>Leave Status</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('enhanced_timetable_v2.preview_all_timetables') }}">
                                <i class="fas fa-eye"></i>
                                <span>Preview Timetables</span>
                            </a>
                        </li>
                        {% endif %}
                    {% endif %}
                    {% if current_user.role in ['admin', 'teacher'] %}
                    <li>
                        <a href="{{ url_for('enhanced_timetable_v2.substitution_management') }}">
                            <i class="fas fa-user-clock"></i>
                            <span>Substitution Management</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>

            <!-- Finance Management -->
            {% if current_user.role != 'teacher' %}
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Finance Management</div>
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('fees.list_fees') }}">
                            <i class="fas fa-dollar-sign"></i>
                            <span>Fees</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('salaries.list_salaries') }}">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Salaries</span>
                        </a>
                    </li>
                </ul>
            </li>
            {% endif %}
            
            <!-- Leave Management -->
            {% if current_user.role == 'admin' %}
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Leave Management</div>
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('dashboard.teacher_leaves') }}" class="position-relative">
                            <i class="fas fa-user-clock"></i>
                            <span>Teacher Leaves</span>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="pendingLeavesBadge">
                                0
                            </span>
                        </a>
                    </li>
                </ul>
            </li>
            {% endif %}

            <!-- Student Complaints -->
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Student Complaints</div>
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('complaints.admin_complaints') }}">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Complaints</span>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Notifications Management -->
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Notifications Management</div>
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('parents.notifications') }}">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('parents.messages') }}">
                            <i class="fas fa-envelope"></i>
                            <span>Messages</span>
                        </a>
                    </li>
                    <li>
                        {% if current_user.role == 'admin' %}
                    <li>
                        <a href="{{ url_for('payments.payment_test') }}">
                            <i class="fas fa-credit-card"></i>
                            <span>Payment Alerts</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>

            <!-- Security & Monitoring -->
            {% if current_user.role == 'admin' %}
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">Security & Monitoring</div>
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('ip_tracker.ip_test') }}">
                            <i class="fas fa-network-wired"></i>
                            <span>IP Tracker</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('dashboard.authorized_activity') }}">
                            <i class="fas fa-bell"></i>
                            <span>Activity Log</span>
                        </a>
                    </li>
                </ul>
            </li>
            {% endif %}

            <!-- System -->
            <li class="menu-section">
                <div class="section-title px-4 py-2 text-xs font-weight-bold text-uppercase text-muted">System</div>
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('dashboard.profile') }}">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('dashboard.settings') }}">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('dashboard.help') }}">
                            <i class="fas fa-question-circle"></i>
                            <span>Help</span>
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Logout -->
            <li class="menu-section">
                <ul class="list-unstyled menu-items">
                    <li>
                        <a href="{{ url_for('auth.logout') }}" class="logout-link">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
