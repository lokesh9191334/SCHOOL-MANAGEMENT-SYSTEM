{% extends 'base.html' %}

{% block content %}
<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-4">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="{{ url_for('dashboard.index') }}">
        <i class="fas fa-home me-1"></i>Dashboard
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Subjects</li>
  </ol>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Subjects Management</h3>
                    <div class="card-tools">
                        <a class="btn btn-success btn-sm" href="{{ url_for('subjects.subjects_analytics') }}">
                            <i class="fas fa-chart-bar"></i> Analytics
                        </a>
                        <a class="btn btn-info btn-sm" href="{{ url_for('subjects.subjects_report') }}">
                            <i class="fas fa-file-alt"></i> Report
                        </a>
                        <a class="btn btn-primary btn-sm" href="{{ url_for('subjects.add_subject') }}">
                            <i class="fas fa-plus"></i> Add Subject
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Statistics Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Total Subjects</h5>
                                    <h2>{{ subjects|length }}</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Assigned Teachers</h5>
                                    <h2>{{ subjects|selectattr('teacher')|list|length }}</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Assigned Classes</h5>
                                    <h2>{{ subjects|selectattr('classroom')|list|length }}</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Unassigned</h5>
                                    <h2>{{ subjects|rejectattr('teacher')|rejectattr('classroom')|list|length }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search and Filter -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="searchInput" placeholder="Search subjects...">
                        </div>
                        <div class="col-md-6">
                            <select class="form-control" id="teacherFilter">
                                <option value="">All Teachers</option>
                                {% for teacher in teachers %}
                                <option value="{{ teacher.name }}">{{ teacher.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Subjects Table -->
                    {% if subjects %}
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered" id="subjectsTable">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Name</th>
                                    <th>Teacher</th>
                                    <th>Class</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for s in subjects %}
                                <tr>
                                    <td>{{ s.name }}</td>
                                    <td>
                                        {% if s.teacher %}
                                            <span class="badge badge-success">{{ s.teacher.name }}</span>
                                        {% else %}
                                            <span class="badge badge-secondary">Unassigned</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if s.classroom %}
                                            <span class="badge badge-info">{{ s.classroom.name }}</span>
                                        {% else %}
                                            <span class="badge badge-secondary">Unassigned</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('subjects.view_subject', subject_id=s.id) }}"
                                           class="btn btn-sm btn-info rounded-pill me-1"><i class="fas fa-eye me-1"></i>View</a>
                                        <a href="{{ url_for('subjects.edit_subject', subject_id=s.id) }}"
                                           class="btn btn-sm btn-warning rounded-pill me-1"><i class="fas fa-edit me-1"></i>Edit</a>
                                        <a href="{{ url_for('subjects.subject_schedule', subject_id=s.id) }}"
                                           class="btn btn-sm btn-primary rounded-pill me-1"><i class="fas fa-calendar-alt me-1"></i>Schedule</a>
                                        <a href="{{ url_for('subjects.subject_grades', subject_id=s.id) }}"
                                           class="btn btn-sm btn-success rounded-pill me-1"><i class="fas fa-clipboard-check me-1"></i>Grades</a>
                                        <a href="{{ url_for('subjects.subject_materials', subject_id=s.id) }}"
                                           class="btn btn-sm btn-secondary rounded-pill me-1"><i class="fas fa-folder-open me-1"></i>Materials</a>
                                        <a href="{{ url_for('subjects.subject_assignments', subject_id=s.id) }}"
                                           class="btn btn-sm rounded-pill me-1"
                                           style="background: linear-gradient(45deg,#6f42c1,#5a32a3); color:#fff; border:0;">
                                           <i class="fas fa-tasks me-1"></i>Assignments
                                        </a>
                                        <a href="{{ url_for('subjects.subject_performance', subject_id=s.id) }}"
                                           class="btn btn-sm btn-outline-primary rounded-pill me-1"><i class="fas fa-chart-line me-1"></i>Performance</a>
                                        <form method="post" action="{{ url_for('subjects.delete_subject', subject_id=s.id) }}"
                                              style="display: inline;"
                                              onsubmit="return confirm('Are you sure you want to delete this subject?')">
                                            <button class="btn btn-sm btn-danger rounded-pill"><i class="fas fa-trash me-1"></i>Delete</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <h4>No subjects found</h4>
                        <p>Get started by adding your first subject.</p>
                        <a class="btn btn-primary" href="{{ url_for('subjects.add_subject') }}">Add Subject</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Search functionality
document.getElementById('searchInput').addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const teacherFilter = document.getElementById('teacherFilter').value.toLowerCase();
    const rows = document.querySelectorAll('#subjectsTable tbody tr');

    rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const teacher = row.cells[1].textContent.toLowerCase();
        const matchesSearch = name.includes(filter);
        const matchesTeacher = !teacherFilter || teacher.includes(teacherFilter);

        row.style.display = matchesSearch && matchesTeacher ? '' : 'none';
    });
});

// Teacher filter
document.getElementById('teacherFilter').addEventListener('change', function() {
    const filter = this.value.toLowerCase();
    const searchFilter = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('#subjectsTable tbody tr');

    rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const teacher = row.cells[1].textContent.toLowerCase();
        const matchesSearch = !searchFilter || name.includes(searchFilter);
        const matchesTeacher = !filter || teacher.includes(filter);

        row.style.display = matchesSearch && matchesTeacher ? '' : 'none';
    });
});
</script>
{% endblock %}
