{% extends 'base.html' %}

{% block content %}
<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Create Installment Plan</h3>
        </div>
        <div class="card-body">
          <form method="POST">
            <div class="mb-3">
              <label for="name" class="form-label">Plan Name *</label>
              <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <textarea class="form-control" id="description" name="description" rows="3"></textarea>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="total_amount" class="form-label">Total Amount *</label>
                  <input type="number" step="0.01" class="form-control" id="total_amount" name="total_amount" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="number_of_installments" class="form-label">Number of Installments *</label>
                  <input type="number" min="2" max="24" class="form-control" id="number_of_installments" name="number_of_installments" required>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="frequency" class="form-label">Payment Frequency *</label>
                  <select class="form-select" id="frequency" name="frequency" required>
                    <option value="">Select Frequency</option>
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="start_date" class="form-label">Start Date *</label>
                  <input type="date" class="form-control" id="start_date" name="start_date" required>
                </div>
              </div>
            </div>
            <div class="mb-3">
              <div class="alert alert-info">
                <strong>Installment Preview:</strong><br>
                <span id="preview">Enter total amount and number of installments to see preview.</span>
              </div>
            </div>
            <div class="d-flex justify-content-between">
              <a href="{{ url_for('fees.list_installment_plans') }}" class="btn btn-secondary">Cancel</a>
              <button type="submit" class="btn btn-primary">Create Plan</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function updatePreview() {
  const totalAmount = parseFloat(document.getElementById('total_amount').value) || 0;
  const installments = parseInt(document.getElementById('number_of_installments').value) || 0;
  const frequency = document.getElementById('frequency').value;
  const startDate = document.getElementById('start_date').value;

  if (totalAmount > 0 && installments > 0) {
    const installmentAmount = totalAmount / installments;
    let preview = `Each installment: $${installmentAmount.toFixed(2)}<br>`;
    preview += `Total installments: ${installments}<br>`;
    preview += `Frequency: ${frequency || 'Not selected'}<br>`;
    if (startDate) {
      preview += `Start date: ${startDate}`;
    }
    document.getElementById('preview').innerHTML = preview;
  } else {
    document.getElementById('preview').innerHTML = 'Enter total amount and number of installments to see preview.';
  }
}

document.getElementById('total_amount').addEventListener('input', updatePreview);
document.getElementById('number_of_installments').addEventListener('input', updatePreview);
document.getElementById('frequency').addEventListener('change', updatePreview);
document.getElementById('start_date').addEventListener('change', updatePreview);
</script>
{% endblock %}
