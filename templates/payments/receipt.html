{% extends "base.html" %}

{% block content %}
<div class="container-fluid receipt-container">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header text-center">
          <h3><i class="fas fa-receipt me-2"></i>Payment Receipt</h3>
        </div>
        <div class="card-body">
          <!-- Receipt Header -->
          <div class="receipt-header text-center mb-4">
            <h4>School Management System</h4>
            <p class="text-muted">Fee Payment Receipt</p>
            <hr>
          </div>
          
          <!-- Payment Details -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h5>Payment Information</h5>
              <table class="table table-sm">
                <tr>
                  <td><strong>Receipt ID:</strong></td>
                  <td>#{{ payment.id }}</td>
                </tr>
                <tr>
                  <td><strong>Transaction ID:</strong></td>
                  <td>{{ payment.transaction_id or 'N/A' }}</td>
                </tr>
                <tr>
                  <td><strong>Payment Date:</strong></td>
                  <td>{{ payment.paid_on.strftime('%d %B %Y') }}</td>
                </tr>
                <tr>
                  <td><strong>Payment Method:</strong></td>
                  <td>{{ payment.payment_method.title() if payment.payment_method else 'N/A' }}</td>
                </tr>
                <tr>
                  <td><strong>Amount Paid:</strong></td>
                  <td class="text-success fw-bold">‚Çπ{{ "%.2f"|format(payment.amount) }}</td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              <h5>Student Information</h5>
              <table class="table table-sm">
                <tr>
                  <td><strong>Student Name:</strong></td>
                  <td>{{ fee.student.name }}</td>
                </tr>
                <tr>
                  <td><strong>Class:</strong></td>
                  <td>{{ fee.student.classroom.name if fee.student.classroom else 'N/A' }}</td>
                </tr>
                <tr>
                  <td><strong>Roll Number:</strong></td>
                  <td>{{ fee.student.roll_number or 'N/A' }}</td>
                </tr>
                <tr>
                  <td><strong>Fee ID:</strong></td>
                  <td>#{{ fee.id }}</td>
                </tr>
                <tr>
                  <td><strong>Due Date:</strong></td>
                  <td>{{ fee.due_date.strftime('%d %B %Y') if fee.due_date else 'N/A' }}</td>
                </tr>
              </table>
            </div>
          </div>
          
          <!-- Fee Breakdown -->
          <div class="row mb-4">
            <div class="col-12">
              <h5>Fee Breakdown</h5>
              <table class="table table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Description</th>
                    <th>Amount</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Total Fee Amount</td>
                    <td>‚Çπ{{ "%.2f"|format(fee.amount) }}</td>
                  </tr>
                  {% if fee.total_discount > 0 %}
                  <tr>
                    <td>Discount Applied</td>
                    <td class="text-success">-‚Çπ{{ "%.2f"|format(fee.total_discount) }}</td>
                  </tr>
                  {% endif %}
                  <tr>
                    <td><strong>Final Amount</strong></td>
                    <td><strong>‚Çπ{{ "%.2f"|format(fee.final_amount) }}</strong></td>
                  </tr>
                  <tr>
                    <td>Previous Payments</td>
                    <td class="text-info">‚Çπ{{ "%.2f"|format(fee.total_paid - payment.amount) }}</td>
                  </tr>
                  <tr class="table-success">
                    <td><strong>This Payment</strong></td>
                    <td><strong>‚Çπ{{ "%.2f"|format(payment.amount) }}</strong></td>
                  </tr>
                  <tr>
                    <td><strong>Total Paid</strong></td>
                    <td><strong>‚Çπ{{ "%.2f"|format(fee.total_paid) }}</strong></td>
                  </tr>
                  <tr>
                    <td><strong>Remaining Balance</strong></td>
                    <td class="{% if fee.remaining_amount > 0 %}text-warning{% else %}text-success{% endif %}">
                      <strong>‚Çπ{{ "%.2f"|format(fee.remaining_amount) }}</strong>
                    </td>
                  </tr>
                  {% if fee.advance_amount > 0 %}
                  <tr class="table-info">
                    <td><strong>Advance Amount</strong></td>
                    <td><strong>‚Çπ{{ "%.2f"|format(fee.advance_amount) }}</strong></td>
                  </tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Payment Status -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="alert alert-{% if fee.payment_status == 'paid' %}success{% elif fee.payment_status == 'advance' %}info{% elif fee.payment_status == 'overdue' %}danger{% else %}warning{% endif %} text-center">
                <h5>
                  <i class="fas fa-{% if fee.payment_status == 'paid' %}check-circle{% elif fee.payment_status == 'advance' %}info-circle{% elif fee.payment_status == 'overdue' %}exclamation-triangle{% else %}clock{% endcycle} me-2"></i>
                  Payment Status: {{ fee.payment_status.title() }}
                </h5>
                {% if fee.payment_status == 'paid' %}
                <p class="mb-0">‚úÖ Fee payment completed successfully!</p>
                {% elif fee.payment_status == 'advance' %}
                <p class="mb-0">üí∞ Advance payment received. Excess amount will be adjusted in future fees.</p>
                {% elif fee.payment_status == 'overdue' %}
                <p class="mb-0">‚è∞ Payment received but fee was overdue. Late charges may apply.</p>
                {% else %}
                <p class="mb-0">‚è≥ Partial payment received. Remaining balance to be paid.</p>
                {% endif %}
              </div>
            </div>
          </div>
          
          <!-- Footer -->
          <div class="receipt-footer text-center">
            <hr>
            <p class="text-muted">
              <small>This is a computer-generated receipt and does not require signature.</small><br>
              <small>Thank you for choosing our school management system.</small>
            </p>
            <div class="mt-3">
              <button class="btn btn-primary" onclick="window.print()">
                <i class="fas fa-print me-2"></i>Print Receipt
              </button>
              <button class="btn btn-secondary ms-2" onclick="window.history.back()">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
              {% if current_user.role == 'parent' %}
              <a href="{{ url_for('payments.parent_fee_payment') }}" class="btn btn-info ms-2">
                <i class="fas fa-credit-card me-2"></i>Make Another Payment
              </a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
@media print {
  .no-print {
    display: none !important;
  }
  
  .receipt-container {
    padding: 0 !important;
  }
  
  .card {
    border: none !important;
    box-shadow: none !important;
  }
  
  .btn {
    display: none !important;
  }
}

.receipt-header {
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.receipt-footer {
  margin-top: 30px;
  padding-top: 20px;
}

.table-bordered th,
.table-bordered td {
  border: 1px solid #dee2e6;
}

.text-success {
  color: #28a745 !important;
}

.text-warning {
  color: #ffc107 !important;
}

.text-info {
  color: #17a2b8 !important;
}

.text-danger {
  color: #dc3545 !important;
}
</style>
{% endblock %}
