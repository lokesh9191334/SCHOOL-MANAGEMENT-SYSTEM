{% extends 'base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        {% if classroom %}Edit Class{% else %}Add New Class{% endif %}
                    </h3>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Class/Section Name *</label>
                                    <select class="form-control" name="name" required>
                                        <option value="">Select Class/Section</option>
                                        {% for grade in range(1, 13) %}
                                        {% for section in ['A', 'B', 'C', 'D'] %}
                                        <option value="Class {{ grade }}{{ section }}" {% if classroom and classroom.name == 'Class ' + grade|string + section %}selected{% endif %}>Class {{ grade }}{{ section }}</option>
                                        {% endfor %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Grade</label>
                                    <select class="form-control" name="grade" id="grade_select">
                                        <option value="">Select Grade</option>
                                        <option value="11" {% if classroom and classroom.grade == '11' %}selected{% endif %}>11th Grade</option>
                                        <option value="12" {% if classroom and classroom.grade == '12' %}selected{% endif %}>12th Grade</option>
                                        <option value="1" {% if classroom and classroom.grade == '1' %}selected{% endif %}>1st Grade</option>
                                        <option value="2" {% if classroom and classroom.grade == '2' %}selected{% endif %}>2nd Grade</option>
                                        <option value="3" {% if classroom and classroom.grade == '3' %}selected{% endif %}>3rd Grade</option>
                                        <option value="4" {% if classroom and classroom.grade == '4' %}selected{% endif %}>4th Grade</option>
                                        <option value="5" {% if classroom and classroom.grade == '5' %}selected{% endif %}>5th Grade</option>
                                        <option value="6" {% if classroom and classroom.grade == '6' %}selected{% endif %}>6th Grade</option>
                                        <option value="7" {% if classroom and classroom.grade == '7' %}selected{% endif %}>7th Grade</option>
                                        <option value="8" {% if classroom and classroom.grade == '8' %}selected{% endif %}>8th Grade</option>
                                        <option value="9" {% if classroom and classroom.grade == '9' %}selected{% endif %}>9th Grade</option>
                                        <option value="10" {% if classroom and classroom.grade == '10' %}selected{% endif %}>10th Grade</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6" id="stream_section" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Stream (for 11th & 12th Grade)</label>
                                    <select class="form-control" name="stream">
                                        <option value="">Select Stream</option>
                                        <option value="medical" {% if classroom and classroom.stream == 'medical' %}selected{% endif %}>Medical</option>
                                        <option value="non-medical" {% if classroom and classroom.stream == 'non-medical' %}selected{% endif %}>Non-Medical</option>
                                        <option value="commerce" {% if classroom and classroom.stream == 'commerce' %}selected{% endif %}>Commerce</option>
                                        <option value="arts" {% if classroom and classroom.stream == 'arts' %}selected{% endif %}>Arts</option>
                                        <option value="medical-with-math" {% if classroom and classroom.stream == 'medical-with-math' %}selected{% endif %}>Medical with Math</option>
                                        <option value="arts-with-math" {% if classroom and classroom.stream == 'arts-with-math' %}selected{% endif %}>Arts with Math</option>
                                        <option value="commerce-with-math" {% if classroom and classroom.stream == 'commerce-with-math' %}selected{% endif %}>Commerce with Math</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <label class="form-label">Academic Year</label>
                                    <select class="form-control" name="academic_year">
                                        <option value="">Select Academic Year</option>
                                        {% for year in range(2020, 2031) %}
                                        <option value="{{ year }}-{{ year + 1 }}" {% if classroom and classroom.academic_year == year|string + '-' + (year+1)|string %}selected{% endif %}>{{ year }}-{{ year + 1 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Capacity</label>
                                    <input type="number" class="form-control" name="capacity" value="{{ classroom.capacity if classroom else '' }}" placeholder="Maximum students" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Room Number</label>
                                    <select class="form-control" name="room">
                                        <option value="">Select Room Number</option>
                                        {% for room_num in range(1, 151) %}
                                        <option value="{{ room_num }}" {% if classroom and classroom.room == room_num|string %}selected{% endif %}>{{ room_num }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Class Teacher</label>
                                    <select class="form-control" name="class_teacher_id">
                                        <option value="">Select Teacher</option>
                                        {% for teacher in teachers %}
                                        <option value="{{ teacher.id }}" {% if classroom and classroom.class_teacher_id == teacher.id %}selected{% endif %}>
                                            {{ teacher.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Class Type</label>
                                    <select class="form-control" name="class_type">
                                        <option value="regular" {% if not classroom or classroom.class_type == 'regular' %}selected{% endif %}>Regular</option>
                                        <option value="special" {% if classroom and classroom.class_type == 'special' %}selected{% endif %}>Special Education</option>
                                        <option value="remedial" {% if classroom and classroom.class_type == 'remedial' %}selected{% endif %}>Remedial</option>
                                        <option value="advanced" {% if classroom and classroom.class_type == 'advanced' %}selected{% endif %}>Advanced</option>
                                        <option value="elective" {% if classroom and classroom.class_type == 'elective' %}selected{% endif %}>Elective</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" name="status">
                                        <option value="active" {% if not classroom or classroom.status == 'active' %}selected{% endif %}>Active</option>
                                        <option value="inactive" {% if classroom and classroom.status == 'inactive' %}selected{% endif %}>Inactive</option>
                                        <option value="archived" {% if classroom and classroom.status == 'archived' %}selected{% endif %}>Archived</option>
                                    </select>
                                </div>
                            </div>
                        </div>



                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('classes.list_classes') }}" class="btn-back">
                                <i class="fas fa-arrow-left me-2"></i>Back to Classes
                            </a>
                            <button class="btn btn-success">Save Class</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const gradeSelect = document.getElementById('grade_select');
    const streamSection = document.getElementById('stream_section');

    function toggleStreamSection() {
        const selectedGrade = gradeSelect.value;
        if (selectedGrade === '11' || selectedGrade === '12') {
            streamSection.style.display = 'block';
        } else {
            streamSection.style.display = 'none';
        }
    }

    gradeSelect.addEventListener('change', toggleStreamSection);
    toggleStreamSection(); // Initial check
});
</script>

{% endblock %}
